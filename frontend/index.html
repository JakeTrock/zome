<!DOCTYPE html>
<html>

<head>
    <title>Zome test panel</title>
</head>

<body>
    <h1>Zome testpanel</h1>

    <div style="display: flex; flex-direction: row;">
        <div style="border: 1px dotted; padding: 10px; flex: 1;">
            <h2>Input</h2>
            <h2>Add Operation</h2>
            <form id="addForm">
                <label for="forceDomain">Force Domain:</label>
                <input type="text" id="forceDomain" name="forceDomain" placeholder="Enter force domain"><br>

                <label for="acl">ACL:</label>
                <input type="text" id="acl" name="acl" placeholder="Enter acl"><br>

                <label for="keys">Keys:</label>
                <input type="text" id="keys" name="keys" placeholder="Enter keys separated by comma" required><br>

                <label for="values">Values:</label>
                <input type="text" id="values" name="values" placeholder="Enter values separated by comma" required><br>

                <button type="submit">Add</button>
            </form>

            <h2>Set Global Write</h2>
            <form id="setGlobalWriteForm">
                <label for="value">ACL:</label>
                <input type="text" id="value" name="value" placeholder="Enter true/false" required><br>

                <button type="submit">Set Global Write</button>
            </form>

            <div>
                <h1>Database</h1>
                <h2>Get Operation</h2>
                <form id="getForm">
                    <label for="forceDomain">Force Domain:</label>
                    <input type="text" id="forceDomain" name="forceDomain" placeholder="Enter force domain"><br>
                    <label for="keys">Keys:</label>
                    <input type="text" id="keys" name="keys" placeholder="Enter keys separated by comma" required><br>

                    <button type="submit">Get</button>
                </form>

                <h2>Delete Operation</h2>
                <form id="deleteForm">
                    <label for="forceDomain">Force Domain:</label>
                    <input type="text" id="forceDomain" name="forceDomain" placeholder="Enter force domain"><br>

                    <label for="keys">Keys:</label>
                    <input type="text" id="keys" name="keys" placeholder="Enter keys separated by comma" required><br>

                    <button type="submit">Delete</button>
                </form>

                <h2>RemoveOrigin Operation</h2>
                <form id="removeOriginForm">
                    <button type="submit">RemoveOrigin</button>
                </form>

                <h2>GetServerStats Operation</h2>
                <form id="getServerStats">
                    <button type="submit">GetServerStats</button>
                </form>
            </div>
            <div>
                <h1>FS</h1>
                <h2>Get Operation</h2>
                <form id="getForm">
                    <label for="forceDomain">Force Domain:</label>
                    <input type="text" id="forceDomain" name="forceDomain" placeholder="Enter force domain"><br>
                    <label for="keys">Keys:</label>
                    <input type="text" id="keys" name="keys" placeholder="Enter keys separated by comma" required><br>

                    <button type="submit">Get</button>
                </form>

                <h2>Delete Operation</h2>
                <form id="deleteForm">
                    <label for="forceDomain">Force Domain:</label>
                    <input type="text" id="forceDomain" name="forceDomain" placeholder="Enter force domain"><br>

                    <label for="keys">Keys:</label>
                    <input type="text" id="keys" name="keys" placeholder="Enter keys separated by comma" required><br>

                    <button type="submit">Delete</button>
                </form>

                <h2>Put Operation</h2>
                <form id="putForm">
                    <label for="forceDomain">Force Domain:</label>
                    <input type="text" id="forceDomain" name="forceDomain" placeholder="Enter force domain"><br>

                    <label for="keys">Keys:</label>
                    <input type="text" id="keys" name="keys" placeholder="Enter keys separated by comma" required><br>

                    <label for="values">Values:</label>
                    <input type="text" id="values" name="values" placeholder="Enter values separated by comma"
                        required><br>

                    <button type="submit">Put</button>
                </form>

            </div>

        </div>

        <div style="border: 1px dotted; padding: 10px; flex: 1;">
            <h2>Output</h2>
            <div id="output" style="overflow:scroll"></div>
        </div>
    </div>
</body>
<script>
    var socket = new WebSocket("ws://localhost:5253/");
    var output = document.getElementById("output");

    socket.onopen = function (event) {
        var message = document.createElement("p");
        message.innerHTML = "WebSocket connection established.";
        output.appendChild(message);
    };

    socket.onmessage = function (event) {
        var response = JSON.parse(event.data);
        var message = document.createElement("p");
        console.log(response)
        message.innerHTML = JSON.stringify(response, null, 2);
        output.appendChild(message);
    };

    socket.onclose = function (event) {
        var message = document.createElement("p");
        message.innerHTML = "WebSocket connection closed.";
        output.appendChild(message);
    };

    function generalizedReq(listenerElement, action) {
        listenerElement.addEventListener("submit", function (event) {
            event.preventDefault();
            const formData = new FormData(listenerElement);
            const codeData = Object.fromEntries(formData.entries());

            var request = {
                action,
                data: {}
            };

            if (formData.get("forceDomain") != null && formData.get("forceDomain").trim() != "") {
                request.forceDomain = formData.get("forceDomain");
            }
            if (formData.get("acl") != null) {
                request.data.acl = formData.get("acl");
            }
            if (formData.get("value") != null) {
                request.data.value = formData.get("value");
            }
            if (formData.get("values") != null && formData.get("keys") != null) {
                const values = formData.get("values").split(",");
                request.data.values = Object.fromEntries(formData.get("keys").split(",").map((key, i) => [key, values[i]]));
            } else if (formData.get("keys") != null) {
                request.data.keys = formData.get("keys").split(",");
            }

            const requestString = JSON.stringify(request);
            console.log(requestString);

            socket.send(requestString);
            listenerElement.reset();
        });
    }

    generalizedReq(document.getElementById("addForm"), "add");
    generalizedReq(document.getElementById("setGlobalWriteForm"), "setGlobalWrite");
    generalizedReq(document.getElementById("getForm"), "get");
    generalizedReq(document.getElementById("deleteForm"), "delete");
    generalizedReq(document.getElementById("removeOriginForm"), "removeOrigin");

    generalizedReq(document.getElementById("getServerStats"), "getServerStats");

    generalizedReq(document.getElementById("putForm"), "put");
    generalizedReq(document.getElementById("getForm"), "get");
    generalizedReq(document.getElementById("deleteForm"), "delete");
</script>

</html>